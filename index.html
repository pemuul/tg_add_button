<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Telegram Post Tools ‚Äî –∫–Ω–æ–ø–∫–∏, –∑–∞–∫—Ä–µ–ø, –æ—Ç–ø—Ä–∞–≤–∫–∞</title>
  <style>
    :root{
      --bg1:#0b1020;
      --bg2:#0a1a2b;
      --card: rgba(255,255,255,.06);
      --card2: rgba(255,255,255,.04);
      --stroke: rgba(255,255,255,.12);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.68);
      --muted2: rgba(255,255,255,.54);
      --shadow: 0 18px 55px rgba(0,0,0,.35);
      --r: 18px;
      --r2: 14px;
      --ok: #2ee59d;
      --warn: #ffd166;
      --bad: #ff4d6d;
      --pri: #6c8cff;
      --pri2:#8b5cf6;
      --line: rgba(255,255,255,.12);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--text);
      font: 15px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial;
      background:
        radial-gradient(1100px 700px at 15% 10%, rgba(108,140,255,.24), transparent 55%),
        radial-gradient(900px 520px at 85% 0%, rgba(139,92,246,.18), transparent 55%),
        radial-gradient(900px 700px at 70% 90%, rgba(46,229,157,.10), transparent 60%),
        linear-gradient(160deg, var(--bg1), var(--bg2));
      overflow-x:hidden;
    }
    a{color:inherit}
    .wrap{max-width:1000px;margin:0 auto;padding:28px 16px 140px}
    header{
      display:flex;align-items:flex-start;justify-content:space-between;gap:16px;
      margin-bottom:16px;
    }
    .brand{
      display:flex;flex-direction:column;gap:6px;
    }
    .h1{
      font-size:26px;font-weight:800;letter-spacing:.2px;
      display:flex;align-items:center;gap:10px;
    }
    .badge{
      font-size:12px;color:rgba(255,255,255,.78);
      padding:6px 10px;border-radius:999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.05);
    }
    .sub{color:var(--muted);max-width:70ch}
    .grid{display:grid;grid-template-columns:1fr;gap:14px}
    @media(min-width:860px){
      .grid.two{grid-template-columns:1fr 1fr}
    }
    .card{
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.04));
      box-shadow: var(--shadow);
      border-radius: var(--r);
      padding:16px;
      backdrop-filter: blur(10px);
    }
    .card.soft{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
    }
    .title{
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      margin:0 0 12px 0;
    }
    .title h2{
      margin:0;font-size:16px;font-weight:800;letter-spacing:.2px;
      display:flex;align-items:center;gap:10px;
    }
    .hint{color:var(--muted2);font-size:13px;margin-top:6px}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .field{display:flex;flex-direction:column;gap:6px;min-width:240px;flex:1}
    label{color:rgba(255,255,255,.82);font-weight:600;font-size:13px}
    input, textarea, select{
      width:100%;
      color:var(--text);
      background: rgba(10,14,28,.55);
      border:1px solid rgba(255,255,255,.14);
      border-radius: 12px;
      padding: 10px 12px;
      outline:none;
      transition: .15s border-color, .15s transform;
    }
    textarea{min-height:86px;resize:vertical}
    input:focus, textarea:focus, select:focus{border-color: rgba(108,140,255,.55)}
    .inline{
      display:flex;align-items:center;gap:10px;flex-wrap:wrap
    }
    .chip{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 10px;border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      color: rgba(255,255,255,.85);
      font-size:13px;
    }
    .chip input{width:auto}
    .btn{
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      cursor:pointer;
      display:inline-flex;align-items:center;justify-content:center;gap:10px;
      transition: .15s transform, .15s background, .15s border-color, .15s filter;
      user-select:none;
    }
    .btn:hover{transform: translateY(-1px);border-color: rgba(255,255,255,.24)}
    .btn:active{transform: translateY(0px);filter: brightness(.96)}
    .btn.primary{
      border-color: rgba(108,140,255,.55);
      background: linear-gradient(135deg, rgba(108,140,255,.35), rgba(139,92,246,.25));
    }
    .btn.danger{
      border-color: rgba(255,77,109,.55);
      background: linear-gradient(135deg, rgba(255,77,109,.28), rgba(255,163,92,.12));
    }
    .btn.ok{
      border-color: rgba(46,229,157,.55);
      background: linear-gradient(135deg, rgba(46,229,157,.22), rgba(108,140,255,.12));
    }
    .btn.ghost{
      background: rgba(255,255,255,.03);
      border-color: rgba(255,255,255,.12);
      color: rgba(255,255,255,.82);
    }
    .btn.small{
      padding: 8px 10px;
      border-radius: 12px;
      font-size: 13px;
    }
    .btn.big{
      padding: 13px 14px;
      border-radius: 16px;
      font-weight: 800;
      letter-spacing: .2px;
      min-width: 220px;
    }
    .status{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      border-radius: 14px;
      padding: 12px;
      display:flex;gap:10px;align-items:flex-start;
    }
    .dot{width:10px;height:10px;border-radius:999px;margin-top:4px;background:rgba(255,255,255,.35)}
    .status.ok .dot{background: var(--ok)}
    .status.bad .dot{background: var(--bad)}
    .status.warn .dot{background: var(--warn)}
    .status .t{font-weight:800}
    .status .m{color:var(--muted);margin-top:2px;white-space:pre-wrap}
    .mono{font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace}
    pre{
      margin:0;
      white-space:pre-wrap;
      word-break:break-word;
      background: rgba(10,14,28,.55);
      border:1px solid rgba(255,255,255,.12);
      border-radius: 14px;
      padding: 12px;
      color: rgba(255,255,255,.88);
      min-height: 70px;
    }
    .split{
      display:flex;gap:12px;flex-wrap:wrap
    }
    .split > *{flex:1;min-width:260px}
    details.card{
      padding:0;
      overflow:hidden;
    }
    details.card > summary{
      list-style:none;
      cursor:pointer;
      padding:16px;
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      font-weight:900;
      border-bottom: 1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
    }
    details.card > summary::-webkit-details-marker{display:none}
    details.card .inner{padding:16px}
    .pill{
      font-size:12px;
      padding:6px 10px;border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      color: rgba(255,255,255,.78);
    }
    .bottom{
      position:fixed;left:0;right:0;bottom:0;
      padding:12px 12px 14px;
      background: linear-gradient(180deg, transparent, rgba(10,14,28,.55) 30%, rgba(10,14,28,.82));
      backdrop-filter: blur(10px);
      border-top: 1px solid rgba(255,255,255,.10);
    }
    .bottom .bar{
      max-width:1000px;margin:0 auto;
      display:flex;flex-direction:column;gap:10px;
    }
    .bottom .mainActions{
      display:flex;gap:10px;flex-wrap:wrap;
      justify-content:center;
    }
    .bottom .extraActions{
      display:flex;gap:10px;flex-wrap:wrap;
      justify-content:center;
      opacity:.85;
    }
    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size:12px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.05);
      padding:2px 6px;border-radius:8px;
      color: rgba(255,255,255,.85);
    }
    .fileRow{
      display:flex;gap:10px;align-items:center;flex-wrap:wrap
    }
    .thumb{
      width:54px;height:54px;border-radius:14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      overflow:hidden;display:flex;align-items:center;justify-content:center;
    }
    .thumb img{width:100%;height:100%;object-fit:cover;display:block}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="h1">Telegram Post Tools <span class="badge">1 —Ñ–∞–π–ª ‚Ä¢ –ª–æ–∫–∞–ª—å–Ω–æ</span></div>
        <div class="sub">
          –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–æ–π –ø–æ–¥ –ø–æ—Å—Ç–æ–º –∫–∞–Ω–∞–ª–∞ (inline keyboard), –∑–∞–∫—Ä–µ–ø/–æ—Ç–∫—Ä–µ–ø, –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–∫—Å—Ç–∞/—Ñ–æ—Ç–æ –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–π —á–∞—Ç/–∫–∞–Ω–∞–ª.
          –ï—Å–ª–∏ –±—Ä–∞—É–∑–µ—Ä –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã (CORS) ‚Äî –∫–æ–ø–∏—Ä—É–π—Ç–µ –≥–æ—Ç–æ–≤—ã–π <span class="kbd">curl</span>.
        </div>
      </div>
      <div class="chip" title="–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ localStorage –Ω–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ">
        üíæ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
      </div>
    </header>

    <div class="grid two">
      <section class="card">
        <div class="title">
          <h2>üîê –î–æ—Å—Ç—É–ø</h2>
          <span class="pill">Bot API token</span>
        </div>

        <div class="row">
          <div class="field">
            <label for="token">–¢–æ–∫–µ–Ω –±–æ—Ç–∞</label>
            <input id="token" type="password" placeholder="123456:ABCDEF..." autocomplete="off" spellcheck="false" />
            <div class="inline">
              <button class="btn small ghost" id="toggleToken">üëÅÔ∏è –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å</button>
              <span class="hint">–¢–æ–∫–µ–Ω —Ö—Ä–∞–Ω–∏—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ —É –≤–∞—Å (localStorage).</span>
            </div>
          </div>
        </div>

        <hr style="border:0;border-top:1px solid var(--line);margin:14px 0" />

        <div class="row">
          <div class="field">
            <label for="postLink">–°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ—Å—Ç –∫–∞–Ω–∞–ª–∞</label>
            <input id="postLink" placeholder="https://t.me/testpemchanel/37" spellcheck="false" />
            <div class="hint">
              –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç: <span class="kbd">t.me/username/ID</span> –∏ <span class="kbd">t.me/c/XXXXXXXX/ID</span> (–ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —Å—É–ø–µ—Ä-–≥—Ä—É–ø–ø—ã/–∫–∞–Ω–∞–ª—ã).
            </div>
          </div>
        </div>
      </section>

      <section class="card">
        <div class="title">
          <h2>üß∑ –ö–Ω–æ–ø–∫–∞ –ø–æ–¥ –ø–æ—Å—Ç–æ–º</h2>
          <span class="pill">editMessageReplyMarkup</span>
        </div>

        <div class="row">
          <div class="field">
            <label for="btnText">–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏</label>
            <input id="btnText" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –û—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É" />
          </div>
          <div class="field">
            <label for="btnUrl">–°—Å—ã–ª–∫–∞ –Ω–∞ –∫–Ω–æ–ø–∫–µ</label>
            <input id="btnUrl" placeholder="https://example.com –∏–ª–∏ tg://..." spellcheck="false" />
            <div class="hint">URL-–∫–Ω–æ–ø–∫–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç <span class="kbd">https://</span>, <span class="kbd">http://</span> –∏ <span class="kbd">tg://</span>. </div>
          </div>
        </div>

        <div class="status warn" id="statusBox" style="margin-top:12px">
          <div class="dot"></div>
          <div>
            <div class="t">–ì–æ—Ç–æ–≤–æ</div>
            <div class="m">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è –∏ –Ω–∞–∂–º–∏—Ç–µ –æ–¥–Ω—É –∏–∑ –∫–Ω–æ–ø–æ–∫ —Å–Ω–∏–∑—É.</div>
          </div>
        </div>
      </section>
    </div>

    <details class="card soft" style="margin-top:14px">
      <summary>‚úâÔ∏è –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç/—Ñ–æ—Ç–æ –≤ —á–∞—Ç –∏–ª–∏ –∫–∞–Ω–∞–ª <span class="pill">sendMessage / sendPhoto</span></summary>
      <div class="inner">
        <div class="grid two">
          <div class="field">
            <label for="sendChatId">–ö—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å (chat_id –∏–ª–∏ @username)</label>
            <input id="sendChatId" placeholder="@mychannel –∏–ª–∏ -1001234567890 –∏–ª–∏ 123456789" spellcheck="false" />
            <div class="hint">
              –î–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–∞–Ω–∞–ª–∞ –º–æ–∂–Ω–æ <span class="kbd">@channelusername</span>. –î–ª—è –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–∞–Ω–∞–ª–∞ –æ–±—ã—á–Ω–æ —á–∏—Å–ª–æ–≤–æ–π id –≤–∏–¥–∞ <span class="kbd">-100...</span>.
              –ü–∞—Ä–∞–º–µ—Ç—Ä <span class="kbd">chat_id</span> —É –º–µ—Ç–æ–¥–æ–≤ Bot API ‚Äî —ç—Ç–æ Integer –∏–ª–∏ String (@username). 
            </div>
          </div>
          <div class="field">
            <label for="threadId">–¢–æ–ø–∏–∫ (message_thread_id) ‚Äî –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ</label>
            <input id="threadId" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 123 (–µ—Å–ª–∏ —Ñ–æ—Ä—É–º/—Ç–æ–ø–∏–∫–∏)" inputmode="numeric" />
            <div class="hint">–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ topics.</div>
          </div>
        </div>

        <div class="field" style="margin-top:10px">
          <label for="sendText">–¢–µ–∫—Å—Ç (–∏–ª–∏ –ø–æ–¥–ø–∏—Å—å –∫ —Ñ–æ—Ç–æ)</label>
          <textarea id="sendText" placeholder="–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è‚Ä¶ (–µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ —Ñ–æ—Ç–æ ‚Äî —ç—Ç–æ caption)"></textarea>
          <div class="hint">
            <span class="kbd">sendMessage</span> –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç, <span class="kbd">sendPhoto</span> ‚Äî —Ñ–æ—Ç–æ —Å –ø–æ–¥–ø–∏—Å—å—é (caption). 
          </div>
        </div>

        <div class="fileRow" style="margin-top:10px">
          <div class="field" style="min-width:260px">
            <label for="sendPhoto">–§–æ—Ç–æ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
            <input id="sendPhoto" type="file" accept="image/*" />
            <div class="hint">–ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ —Ñ–æ—Ç–æ ‚Äî –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω <span class="kbd">sendPhoto</span>, –∏–Ω–∞—á–µ <span class="kbd">sendMessage</span>.</div>
          </div>
          <div class="thumb" id="thumb" title="–ü—Ä–µ–≤—å—é">
            <span style="color:rgba(255,255,255,.55);font-size:12px">preview</span>
          </div>
          <div class="inline">
            <label class="chip"><input type="checkbox" id="silent" /> –ë–µ–∑ –∑–≤—É–∫–∞ (disable_notification)</label>
            <label class="chip"><input type="checkbox" id="htmlMode" /> parse_mode=HTML</label>
          </div>
        </div>

        <div class="row" style="margin-top:12px">
          <button class="btn ok" id="sendBtn">üì® –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
          <button class="btn ghost" id="copyCurlSend">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å curl (–æ—Ç–ø—Ä–∞–≤–∫–∞)</button>
        </div>

        <div class="status" id="sendStatus" style="margin-top:12px">
          <div class="dot"></div>
          <div>
            <div class="t">–û—Ç–ø—Ä–∞–≤–∫–∞</div>
            <div class="m">–¢—É—Ç –ø–æ—è–≤–∏—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç (ok/error).</div>
          </div>
        </div>
      </div>
    </details>

    <details class="card soft" style="margin-top:14px">
      <summary>‚ÑπÔ∏è –ß—Ç–æ –º–æ–∂–Ω–æ ¬´–∑–∞—à–∏—Ç—å¬ª –≤ —Å—Å—ã–ª–∫—É –∫–Ω–æ–ø–∫–∏ <span class="pill">deep links</span></summary>
      <div class="inner">
        <div class="hint" style="margin:0 0 10px 0">
          –ö–Ω–æ–ø–∫–∞ –≤ inline keyboard –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç URL (HTTP –∏–ª–∏ tg://). 
        </div>
        <ul style="margin:0;padding-left:18px;color:rgba(255,255,255,.82)">
          <li style="margin:8px 0">
            <b>Deep link –Ω–∞ –±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏</b>: <span class="mono">https://t.me/your_bot?start=PAYLOAD</span> ‚Äî
            –±–æ—Ç –ø–æ–ª—É—á–∏—Ç <span class="mono">/start PAYLOAD</span>. –†–∞–∑—Ä–µ—à–µ–Ω—ã —Å–∏–º–≤–æ–ª—ã <span class="mono">A-Z a-z 0-9 _ -</span>, –¥–ª–∏–Ω–∞ –¥–æ 64. 
          </li>
          <li style="margin:8px 0">
            <b>Deep link –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É</b>: <span class="mono">https://t.me/your_bot?startgroup=PAYLOAD</span>. 
          </li>
          <li style="margin:8px 0">
            <b>–û—Ç–ø—Ä–∞–≤–∫–∞ ‚Äú–∑–∞–≥–æ—Ç–æ–≤–∫–∏‚Äù —á–µ—Ä–µ–∑ —ç–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ —á–∞—Ç–∞</b>:
            <span class="mono">https://t.me/share/url?url=ENC_URL&text=ENC_TEXT</span> ‚Äî
            –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –≤—ã–±–æ—Ä, –∫—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å, –∏ –±—É–¥–µ—Ç –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç/—Å—Å—ã–ª–∫–∞. 
          </li>
          <li style="margin:8px 0">
            <b>–û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç/–∫–∞–Ω–∞–ª –ø–æ username</b>:
            <span class="mono">https://t.me/username</span> (—á–µ–ª–æ–≤–µ–∫/–≥—Ä—É–ø–ø–∞/–∫–∞–Ω–∞–ª, –µ—Å–ª–∏ –ø—É–±–ª–∏—á–Ω—ã–µ).
          </li>
          <li style="margin:8px 0">
            <b>tg:// —Å—Å—ã–ª–∫–∏</b> (–∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ deep links): –æ–±—â–∏–π —Ñ–æ—Ä–º–∞—Ç –æ–ø–∏—Å–∞–Ω –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ deep links. 
            <br/>–û—Ç–¥–µ–ª—å–Ω–æ –ø–æ–ª–µ–∑–Ω–æ: <span class="mono">tg://user?id=123456789</span> ‚Äî —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ/–ø–µ—Ä–µ—Ö–æ–¥ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ id (–µ—Å–ª–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å—é). 
          </li>
          <li style="margin:8px 0">
            <b>–í–∞–∂–Ω–æ –ø—Ä–æ ‚Äú–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –≤ —á–∞—Ç –∫ —á–µ–ª–æ–≤–µ–∫—É —Å –¥–∞–Ω–Ω—ã–º–∏‚Äù</b>:
            Telegram –Ω–µ –¥–∞—ë—Ç –Ω–∞–¥—ë–∂–Ω—ã–π –ø—É–±–ª–∏—á–Ω—ã–π URL, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–∫—Ä–æ–µ—Ç <i>–ø—Ä—è–º–æ –ª–∏—á–∫—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞</i> —Å —É–∂–µ –Ω–∞–±—Ä–∞–Ω–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º.
            –û–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç: (1) deep link –Ω–∞ <b>–±–æ—Ç–∞</b> —Å payload, (2) –∏–ª–∏ <b>share/url</b> —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∞–º –≤—ã–±—Ä–∞–ª —á–∞—Ç. 
          </li>
        </ul>
      </div>
    </details>

    <section class="card soft" style="margin-top:14px">
      <div class="title">
        <h2>üßæ curl (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)</h2>
        <span class="pill">–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª</span>
      </div>
      <div class="split">
        <div>
          <div class="hint" style="margin:0 0 8px 0">–ü–æ—Å–ª–µ–¥–Ω—è—è –∫–æ–º–∞–Ω–¥–∞ curl, –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Ä—É—á–Ω—É—é (–µ—Å–ª–∏ CORS –º–µ—à–∞–µ—Ç).</div>
          <pre id="curlBox" class="mono">‚Äî</pre>
          <div class="row" style="margin-top:10px">
            <button class="btn ghost" id="copyCurlGlobal">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <button class="btn ghost" id="clearLog">üßπ –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>
          </div>
        </div>
        <div>
          <div class="hint" style="margin:0 0 8px 0">–õ–æ–≥ –æ—Ç–≤–µ—Ç–∞/–æ—à–∏–±–∫–∏</div>
          <pre id="logBox" class="mono">‚Äî</pre>
        </div>
      </div>
    </section>

    <section class="card soft" style="margin-top:14px">
      <div class="title">
        <h2>‚ö†Ô∏è –ü—Ä–∞–≤–∞ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è</h2>
        <span class="pill">–≤–∞–∂–Ω–æ</span>
      </div>
      <div class="hint" style="margin:0">
        ‚Ä¢ –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –ø—Ä–∞–≤–∞ –≤ –∫–∞–Ω–∞–ª–µ/—á–∞—Ç–µ. –î–ª—è –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏—è —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–∞–≤–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–∏ –≤ —Ü–µ–ª–æ–º –±–æ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–¥–º–∏–Ω–æ–º/–∏–º–µ—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ). 
        <br/>‚Ä¢ –ë–æ—Ç—ã <b>–Ω–µ –º–æ–≥—É—Ç –ø–µ—Ä–≤—ã–º–∏</b> –Ω–∞—á–∞—Ç—å –ª–∏—á–Ω—ã–π –¥–∏–∞–ª–æ–≥ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –Ω–∞–ø–∏—Å–∞—Ç—å –±–æ—Ç—É /start –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É. 
      </div>
    </section>
  </div>

  <div class="bottom">
    <div class="bar">
      <div class="mainActions">
        <button class="btn primary big" id="applyBtn">‚úÖ –î–æ–±–∞–≤–∏—Ç—å / –æ–±–Ω–æ–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É</button>
        <button class="btn danger big" id="removeBtn">üóëÔ∏è –£–±—Ä–∞—Ç—å –∫–Ω–æ–ø–∫—É</button>
      </div>
      <div class="extraActions">
        <button class="btn small ghost" id="pinBtn">üìå –ó–∞–∫—Ä–µ–ø–∏—Ç—å</button>
        <button class="btn small ghost" id="unpinBtn">üìç –û—Ç–∫—Ä–µ–ø–∏—Ç—å</button>
        <button class="btn small ghost" id="copyCurlMain">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å curl (–ø–æ—Å–ª–µ–¥–Ω–∏–π)</button>
      </div>
    </div>
  </div>

<script>
(() => {
  const $ = (id) => document.getElementById(id);

  const el = {
    token: $("token"),
    postLink: $("postLink"),
    btnText: $("btnText"),
    btnUrl: $("btnUrl"),
    statusBox: $("statusBox"),
    logBox: $("logBox"),
    curlBox: $("curlBox"),
    toggleToken: $("toggleToken"),

    applyBtn: $("applyBtn"),
    removeBtn: $("removeBtn"),
    pinBtn: $("pinBtn"),
    unpinBtn: $("unpinBtn"),

    copyCurlGlobal: $("copyCurlGlobal"),
    copyCurlMain: $("copyCurlMain"),
    clearLog: $("clearLog"),

    // send panel
    sendChatId: $("sendChatId"),
    threadId: $("threadId"),
    sendText: $("sendText"),
    sendPhoto: $("sendPhoto"),
    thumb: $("thumb"),
    silent: $("silent"),
    htmlMode: $("htmlMode"),
    sendBtn: $("sendBtn"),
    copyCurlSend: $("copyCurlSend"),
    sendStatus: $("sendStatus")
  };

  const LS_KEYS = {
    token: "tpt_token",
    postLink: "tpt_postLink",
    btnText: "tpt_btnText",
    btnUrl: "tpt_btnUrl",
    sendChatId: "tpt_sendChatId",
    threadId: "tpt_threadId",
    htmlMode: "tpt_htmlMode",
    silent: "tpt_silent"
  };

  // --- helpers
  let lastCurl = "‚Äî";
  let lastSendCurl = "‚Äî";

  function setStatus(type, title, msg, extra) {
    el.statusBox.className = "status " + (type || "");
    el.statusBox.querySelector(".t").textContent = title || "";
    el.statusBox.querySelector(".m").textContent = (msg || "") + (extra ? ("\n\n" + extra) : "");
  }
  function setSendStatus(type, title, msg, extra) {
    el.sendStatus.className = "status " + (type || "");
    el.sendStatus.querySelector(".t").textContent = title || "";
    el.sendStatus.querySelector(".m").textContent = (msg || "") + (extra ? ("\n\n" + extra) : "");
  }
  function log(objOrText) {
    if (typeof objOrText === "string") {
      el.logBox.textContent = objOrText;
      return;
    }
    try {
      el.logBox.textContent = JSON.stringify(objOrText, null, 2);
    } catch {
      el.logBox.textContent = String(objOrText);
    }
  }
  function setCurl(text) {
    lastCurl = text || "‚Äî";
    el.curlBox.textContent = lastCurl;
  }
  function buildApiBase(token) {
    return `https://api.telegram.org/bot${token}`;
  }
  function asJsonString(obj) {
    return JSON.stringify(obj, null, 0);
  }
  function escapeSingleQuotes(s) {
    return String(s).replace(/'/g, `'\\''`);
  }
  function isProbablyUrl(u) {
    const s = (u || "").trim();
    return /^https?:\/\//i.test(s) || /^tg:\/\//i.test(s);
  }

  function parseMessageLink(input) {
    const raw = (input || "").trim();
    if (!raw) throw new Error("–£–∫–∞–∂–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –ø–æ—Å—Ç.");
    const normalized = raw.includes("://") ? raw : ("https://" + raw.replace(/^\/+/, ""));
    let url;
    try { url = new URL(normalized); } catch { throw new Error("–ù–µ –º–æ–≥—É —Ä–∞–∑–æ–±—Ä–∞—Ç—å —Å—Å—ã–ª–∫—É. –ü—Ä–∏–º–µ—Ä: https://t.me/channel/37"); }

    const parts = url.pathname.split("/").filter(Boolean);
    // t.me/<username>/<msg_id>
    // t.me/c/<internal>/<msg_id>
    if (parts.length < 2) throw new Error("–í —Å—Å—ã–ª–∫–µ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç ID —Å–æ–æ–±—â–µ–Ω–∏—è.");

    if (parts[0] === "c") {
      if (parts.length < 3) throw new Error("–§–æ—Ä–º–∞—Ç t.me/c/XXXX/ID: –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç —á–∞—Å—Ç–µ–π.");
      const internal = parts[1];
      const msgId = parts[2];
      if (!/^\d+$/.test(internal) || !/^\d+$/.test(msgId)) throw new Error("–û–∂–∏–¥–∞—é —á–∏—Å–ª–∞ –≤ t.me/c/XXXX/ID.");
      return { chat_id: `-100${internal}`, message_id: Number(msgId), kind: "private" };
    }

    const username = parts[0];
    const msgId = parts[1];
    if (!/^\d+$/.test(msgId)) throw new Error("ID —Å–æ–æ–±—â–µ–Ω–∏—è –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º (–ø–æ—Å–ª–µ–¥–Ω—è—è —á–∞—Å—Ç—å —Å—Å—ã–ª–∫–∏).");
    return { chat_id: username.startsWith("@") ? username : ("@" + username), message_id: Number(msgId), kind: "public" };
  }

  async function tryFetchJson(url, payload) {
    const res = await fetch(url, {
      method: "POST",
      headers: { "Content-Type":"application/json" },
      body: JSON.stringify(payload)
    });
    const data = await res.json().catch(() => ({}));
    return data;
  }

  async function tryFetchFormData(url, formData) {
    const res = await fetch(url, { method: "POST", body: formData });
    const data = await res.json().catch(() => ({}));
    return data;
  }

  function curlForJson(token, method, payload) {
    const api = buildApiBase(token);
    const body = asJsonString(payload);
    return [
      `curl -s -X POST '${api}/${method}' \\`,
      `  -H 'Content-Type: application/json' \\`,
      `  -d '${escapeSingleQuotes(body)}'`
    ].join("\n");
  }

  function curlForPhoto(token, payload, filenamePlaceholder) {
    const api = buildApiBase(token);
    // payload: {chat_id, caption, disable_notification, parse_mode, message_thread_id}
    const args = [];
    for (const [k,v] of Object.entries(payload)) {
      if (v === undefined || v === null || v === "") continue;
      args.push(`  -F '${k}=${escapeSingleQuotes(v)}' \\`);
    }
    // last line: photo
    args.push(`  -F 'photo=@${filenamePlaceholder || "PATH_TO_IMAGE.jpg"}'`);
    return [
      `curl -s -X POST '${api}/sendPhoto' \\`,
      ...args
    ].join("\n");
  }

  function ensureToken() {
    const token = (el.token.value || "").trim();
    if (!token) throw new Error("–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞.");
    return token;
  }

  function setGlobalCurlAndLog(curlText, responseObj) {
    setCurl(curlText);
    log(responseObj);
  }

  async function callBotApiJson(method, payload) {
    const token = ensureToken();
    const url = `${buildApiBase(token)}/${method}`;
    const curl = curlForJson(token, method, payload);
    setCurl(curl);

    try {
      const data = await tryFetchJson(url, payload);
      return { data, curl };
    } catch (e) {
      return { data: null, curl, error: e };
    }
  }

  async function callBotApiPhoto(payload, file) {
    const token = ensureToken();
    const url = `${buildApiBase(token)}/sendPhoto`;

    const curl = curlForPhoto(token, payload, "PATH_TO_IMAGE.jpg");
    setCurl(curl);

    const fd = new FormData();
    for (const [k,v] of Object.entries(payload)) {
      if (v === undefined || v === null || v === "") continue;
      fd.append(k, String(v));
    }
    fd.append("photo", file);

    try {
      const data = await tryFetchFormData(url, fd);
      return { data, curl };
    } catch (e) {
      return { data: null, curl, error: e };
    }
  }

  // --- main actions
  async function applyButton() {
    const token = ensureToken();
    const { chat_id, message_id } = parseMessageLink(el.postLink.value);

    const text = (el.btnText.value || "").trim();
    const url = (el.btnUrl.value || "").trim();

    if (!text) throw new Error("–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏.");
    if (!url) throw new Error("–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É –∫–Ω–æ–ø–∫–∏.");
    if (!isProbablyUrl(url)) throw new Error("–°—Å—ã–ª–∫–∞ –¥–æ–ª–∂–Ω–∞ –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å http(s):// –∏–ª–∏ tg://");

    const payload = {
      chat_id,
      message_id,
      reply_markup: {
        inline_keyboard: [[{ text, url }]]
      }
    };

    setStatus("warn", "–û—Ç–ø—Ä–∞–≤–ª—è—é‚Ä¶", "–ü—Ä–æ–±—É—é –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞. –ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏—Ç—Å—è (CORS) ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ curl –Ω–∏–∂–µ.");
    const { data, curl, error } = await callBotApiJson("editMessageReplyMarkup", payload);

    if (data && data.ok) {
      setStatus("ok", "–£—Å–ø–µ—à–Ω–æ ‚úÖ", "–ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞/–æ–±–Ω–æ–≤–ª–µ–Ω–∞.");
      setGlobalCurlAndLog(curl, data);
      return;
    }

    const msg = (data && data.description) ? data.description : (error ? (error.message || String(error)) : "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞");
    setStatus("bad", "–ù–µ –≤—ã—à–ª–æ ‚ùå", msg, "–°–∫–æ–ø–∏—Ä—É–π—Ç–µ curl —Å–Ω–∏–∑—É –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ.");
    setGlobalCurlAndLog(curl, data || { ok:false, error: msg });
  }

  async function removeButton() {
    ensureToken();
    const { chat_id, message_id } = parseMessageLink(el.postLink.value);

    const payload = {
      chat_id,
      message_id,
      reply_markup: { inline_keyboard: [] }
    };

    setStatus("warn", "–û—Ç–ø—Ä–∞–≤–ª—è—é‚Ä¶", "–ü—Ä–æ–±—É—é —É–±—Ä–∞—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É. –ï—Å–ª–∏ CORS ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ curl –Ω–∏–∂–µ.");
    const { data, curl, error } = await callBotApiJson("editMessageReplyMarkup", payload);

    if (data && data.ok) {
      setStatus("ok", "–£—Å–ø–µ—à–Ω–æ ‚úÖ", "–ö–Ω–æ–ø–∫–∞ —É–±—Ä–∞–Ω–∞ (inline keyboard –æ—á–∏—â–µ–Ω).");
      setGlobalCurlAndLog(curl, data);
      return;
    }

    const msg = (data && data.description) ? data.description : (error ? (error.message || String(error)) : "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞");
    setStatus("bad", "–ù–µ –≤—ã—à–ª–æ ‚ùå", msg, "–°–∫–æ–ø–∏—Ä—É–π—Ç–µ curl —Å–Ω–∏–∑—É –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ.");
    setGlobalCurlAndLog(curl, data || { ok:false, error: msg });
  }

  async function pinPost() {
    ensureToken();
    const { chat_id, message_id } = parseMessageLink(el.postLink.value);

    const payload = {
      chat_id,
      message_id,
      disable_notification: true
    };

    setStatus("warn", "–û—Ç–ø—Ä–∞–≤–ª—è—é‚Ä¶", "–ü—Ä–æ–±—É—é –∑–∞–∫—Ä–µ–ø–∏—Ç—å. –¢—Ä–µ–±—É—é—Ç—Å—è –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —É –±–æ—Ç–∞.");
    const { data, curl, error } = await callBotApiJson("pinChatMessage", payload);

    if (data && data.ok) {
      setStatus("ok", "–£—Å–ø–µ—à–Ω–æ ‚úÖ", "–°–æ–æ–±—â–µ–Ω–∏–µ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–æ.");
      setGlobalCurlAndLog(curl, data);
      return;
    }

    const msg = (data && data.description) ? data.description : (error ? (error.message || String(error)) : "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞");
    setStatus("bad", "–ù–µ –≤—ã—à–ª–æ ‚ùå", msg, "–°–∫–æ–ø–∏—Ä—É–π—Ç–µ curl —Å–Ω–∏–∑—É –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ.");
    setGlobalCurlAndLog(curl, data || { ok:false, error: msg });
  }

  async function unpinPost() {
    ensureToken();
    const { chat_id, message_id } = parseMessageLink(el.postLink.value);

    const payload = { chat_id, message_id };

    setStatus("warn", "–û—Ç–ø—Ä–∞–≤–ª—è—é‚Ä¶", "–ü—Ä–æ–±—É—é –æ—Ç–∫—Ä–µ–ø–∏—Ç—å. –¢—Ä–µ–±—É—é—Ç—Å—è –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —É –±–æ—Ç–∞.");
    const { data, curl, error } = await callBotApiJson("unpinChatMessage", payload);

    if (data && data.ok) {
      setStatus("ok", "–£—Å–ø–µ—à–Ω–æ ‚úÖ", "–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–∫—Ä–µ–ø–ª–µ–Ω–æ.");
      setGlobalCurlAndLog(curl, data);
      return;
    }

    const msg = (data && data.description) ? data.description : (error ? (error.message || String(error)) : "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞");
    setStatus("bad", "–ù–µ –≤—ã—à–ª–æ ‚ùå", msg, "–°–∫–æ–ø–∏—Ä—É–π—Ç–µ curl —Å–Ω–∏–∑—É –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ.");
    setGlobalCurlAndLog(curl, data || { ok:false, error: msg });
  }

  // --- send panel
  function normalizeChatId(v) {
    const s = (v || "").trim();
    if (!s) throw new Error("–í–≤–µ–¥–∏—Ç–µ chat_id –∏–ª–∏ @username, –∫—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å.");
    // If it's numeric, keep as number-like string; Bot API accepts Integer or String anyway.
    return s;
  }

  function getOptionalInt(v) {
    const s = (v || "").trim();
    if (!s) return undefined;
    if (!/^\d+$/.test(s)) throw new Error("message_thread_id –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º.");
    return Number(s);
  }

  function previewFile(file) {
    if (!file) {
      el.thumb.innerHTML = `<span style="color:rgba(255,255,255,.55);font-size:12px">preview</span>`;
      return;
    }
    const url = URL.createObjectURL(file);
    el.thumb.innerHTML = `<img alt="preview" src="${url}" />`;
  }

  async function sendMessageOrPhoto() {
    ensureToken();
    const chat_id = normalizeChatId(el.sendChatId.value);
    const message_thread_id = getOptionalInt(el.threadId.value);
    const text = (el.sendText.value || "").trim();
    const disable_notification = !!el.silent.checked;
    const parse_mode = el.htmlMode.checked ? "HTML" : undefined;

    const file = el.sendPhoto.files && el.sendPhoto.files[0] ? el.sendPhoto.files[0] : null;

    setSendStatus("warn", "–û—Ç–ø—Ä–∞–≤–ª—è—é‚Ä¶", "–ü—Ä–æ–±—É—é –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞. –ï—Å–ª–∏ CORS –ø–æ–º–µ—à–∞–µ—Ç ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ curl –Ω–∏–∂–µ.");

    if (file) {
      const payload = {
        chat_id,
        caption: text || undefined,
        parse_mode,
        disable_notification,
        message_thread_id
      };

      const { data, curl, error } = await callBotApiPhoto(payload, file);
      lastSendCurl = curl;

      if (data && data.ok) {
        const mid = data.result && data.result.message_id ? data.result.message_id : "‚Äî";
        setSendStatus("ok", "–£—Å–ø–µ—à–Ω–æ ‚úÖ", `–§–æ—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ. message_id: ${mid}`);
        setGlobalCurlAndLog(curl, data);
        return;
      }

      const msg = (data && data.description) ? data.description : (error ? (error.message || String(error)) : "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞");
      setSendStatus("bad", "–ù–µ –≤—ã—à–ª–æ ‚ùå", msg, "–°–∫–æ–ø–∏—Ä—É–π—Ç–µ curl –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ (—Ñ–∞–π–ª —É–∫–∞–∂–∏—Ç–µ —Å–≤–æ–∏–º –ø—É—Ç—ë–º).");
      setGlobalCurlAndLog(curl, data || { ok:false, error: msg });
      return;
    }

    // text-only
    if (!text) throw new Error("–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è (–∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ç–æ).");

    const payload = {
      chat_id,
      text,
      parse_mode,
      disable_notification,
      message_thread_id
    };

    const { data, curl, error } = await callBotApiJson("sendMessage", payload);
    lastSendCurl = curl;

    if (data && data.ok) {
      const mid = data.result && data.result.message_id ? data.result.message_id : "‚Äî";
      setSendStatus("ok", "–£—Å–ø–µ—à–Ω–æ ‚úÖ", `–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ. message_id: ${mid}`);
      setGlobalCurlAndLog(curl, data);
      return;
    }

    const msg = (data && data.description) ? data.description : (error ? (error.message || String(error)) : "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞");
    setSendStatus("bad", "–ù–µ –≤—ã—à–ª–æ ‚ùå", msg, "–°–∫–æ–ø–∏—Ä—É–π—Ç–µ curl –Ω–∏–∂–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ.");
    setGlobalCurlAndLog(curl, data || { ok:false, error: msg });
  }

  // --- persistence
  function save() {
    localStorage.setItem(LS_KEYS.token, el.token.value || "");
    localStorage.setItem(LS_KEYS.postLink, el.postLink.value || "");
    localStorage.setItem(LS_KEYS.btnText, el.btnText.value || "");
    localStorage.setItem(LS_KEYS.btnUrl, el.btnUrl.value || "");
    localStorage.setItem(LS_KEYS.sendChatId, el.sendChatId.value || "");
    localStorage.setItem(LS_KEYS.threadId, el.threadId.value || "");
    localStorage.setItem(LS_KEYS.htmlMode, el.htmlMode.checked ? "1" : "0");
    localStorage.setItem(LS_KEYS.silent, el.silent.checked ? "1" : "0");
  }
  function load() {
    el.token.value = localStorage.getItem(LS_KEYS.token) || "";
    el.postLink.value = localStorage.getItem(LS_KEYS.postLink) || "";
    el.btnText.value = localStorage.getItem(LS_KEYS.btnText) || "";
    el.btnUrl.value = localStorage.getItem(LS_KEYS.btnUrl) || "";
    el.sendChatId.value = localStorage.getItem(LS_KEYS.sendChatId) || "";
    el.threadId.value = localStorage.getItem(LS_KEYS.threadId) || "";
    el.htmlMode.checked = (localStorage.getItem(LS_KEYS.htmlMode) || "0") === "1";
    el.silent.checked = (localStorage.getItem(LS_KEYS.silent) || "0") === "1";
  }

  // --- events
  ["input","change"].forEach(evt => {
    document.addEventListener(evt, (e) => {
      const ids = new Set(["token","postLink","btnText","btnUrl","sendChatId","threadId","htmlMode","silent"]);
      if (e.target && ids.has(e.target.id)) save();
    });
  });

  el.toggleToken.addEventListener("click", () => {
    el.token.type = (el.token.type === "password") ? "text" : "password";
  });

  el.applyBtn.addEventListener("click", () => applyButton().catch(err => {
    setStatus("bad", "–û—à–∏–±–∫–∞ ‚ùå", err.message || String(err));
  }));
  el.removeBtn.addEventListener("click", () => removeButton().catch(err => {
    setStatus("bad", "–û—à–∏–±–∫–∞ ‚ùå", err.message || String(err));
  }));
  el.pinBtn.addEventListener("click", () => pinPost().catch(err => {
    setStatus("bad", "–û—à–∏–±–∫–∞ ‚ùå", err.message || String(err));
  }));
  el.unpinBtn.addEventListener("click", () => unpinPost().catch(err => {
    setStatus("bad", "–û—à–∏–±–∫–∞ ‚ùå", err.message || String(err));
  }));

  el.sendPhoto.addEventListener("change", () => {
    const f = el.sendPhoto.files && el.sendPhoto.files[0] ? el.sendPhoto.files[0] : null;
    previewFile(f);
  });

  el.sendBtn.addEventListener("click", () => sendMessageOrPhoto().catch(err => {
    setSendStatus("bad", "–û—à–∏–±–∫–∞ ‚ùå", err.message || String(err));
  }));

  async function copyText(text) {
    await navigator.clipboard.writeText(text);
  }

  el.copyCurlGlobal.addEventListener("click", async () => {
    await copyText(lastCurl || "");
    setStatus("ok", "–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ ‚úÖ", "curl-–∫–æ–º–∞–Ω–¥–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä.");
  });
  el.copyCurlMain.addEventListener("click", async () => {
    await copyText(lastCurl || "");
    setStatus("ok", "–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ ‚úÖ", "curl-–∫–æ–º–∞–Ω–¥–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä.");
  });
  el.copyCurlSend.addEventListener("click", async () => {
    const t = lastSendCurl && lastSendCurl !== "‚Äî" ? lastSendCurl : lastCurl;
    await copyText(t || "");
    setSendStatus("ok", "–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ ‚úÖ", "curl-–∫–æ–º–∞–Ω–¥–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä.");
  });

  el.clearLog.addEventListener("click", () => {
    log("‚Äî");
    setCurl("‚Äî");
    setStatus("warn", "–ì–æ—Ç–æ–≤–æ", "–õ–æ–≥–∏ –æ—á–∏—â–µ–Ω—ã.");
  });

  // init
  load();
  log("‚Äî");
  setCurl("‚Äî");
})();
</script>
</body>
</html>
