<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Telegram: –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É / –∑–∞–∫—Ä–µ–ø–∏—Ç—å –ø–æ—Å—Ç</title>
  <style>
    :root{
      --bg1:#0b1020;
      --bg2:#070a14;
      --card: rgba(255,255,255,.08);
      --card2: rgba(255,255,255,.06);
      --stroke: rgba(255,255,255,.12);
      --stroke2: rgba(255,255,255,.16);
      --txt: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.68);
      --muted2: rgba(255,255,255,.52);
      --ok:#22c55e;
      --warn:#f59e0b;
      --bad:#ef4444;
      --shadow: 0 18px 55px rgba(0,0,0,.45);
      --radius: 18px;
      --radius2: 14px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: var(--sans);
      color: var(--txt);
      background:
        radial-gradient(1200px 700px at 15% 10%, rgba(79,70,229,.30), transparent 60%),
        radial-gradient(1100px 650px at 85% 20%, rgba(6,182,212,.24), transparent 55%),
        radial-gradient(900px 600px at 70% 90%, rgba(34,197,94,.16), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding: 28px 18px 44px;
    }

    .wrap{ width:min(980px, 100%); }

    .header{
      display:flex; gap:14px; align-items:center; justify-content:space-between;
      margin-bottom: 16px;
    }

    .brand{
      display:flex; align-items:center; gap:12px;
    }
    .logo{
      width:40px; height:40px; border-radius: 12px;
      background:
        radial-gradient(18px 18px at 30% 30%, rgba(255,255,255,.35), transparent 60%),
        linear-gradient(135deg, rgba(79,70,229,.95), rgba(6,182,212,.95));
      box-shadow: 0 10px 26px rgba(0,0,0,.35);
    }
    h1{
      margin:0;
      font-size: 18px;
      line-height:1.2;
      letter-spacing:.2px;
    }
    .sub{
      margin-top: 2px;
      font-size: 13px;
      color: var(--muted);
    }

    .pill{
      display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;
      align-items:center;
    }
    .chip{
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.05);
      padding: 8px 10px;
      border-radius: 999px;
      font-size: 12px;
      color: var(--muted);
      backdrop-filter: blur(10px);
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,.06));
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .content{
      padding: 18px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }

    @media (max-width: 860px){
      .grid{ grid-template-columns: 1fr; }
      .pill{ justify-content:flex-start; }
    }

    .field{
      background: rgba(255,255,255,.05);
      border: 1px solid var(--stroke);
      border-radius: var(--radius2);
      padding: 12px;
    }

    label{
      display:block;
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 7px;
    }

    input, textarea{
      width:100%;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.20);
      color: var(--txt);
      border-radius: 12px;
      padding: 11px 12px;
      outline:none;
      font-size: 14px;
    }
    input::placeholder, textarea::placeholder{ color: rgba(255,255,255,.40); }

    textarea{ min-height: 104px; resize: vertical; font-family: var(--mono); font-size: 12.5px; line-height: 1.35; }

    .row{
      display:flex; gap:10px; align-items:center; flex-wrap:wrap;
      margin-top: 10px;
    }

    .hint{
      font-size: 12px;
      color: var(--muted2);
      margin-top: 8px;
      line-height: 1.35;
    }

    .mini{
      font-size: 12px; color: var(--muted2);
    }

    .status{
      margin-top: 14px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      border-radius: var(--radius2);
      padding: 12px;
    }

    .statusLine{
      display:flex;
      gap:10px;
      align-items:flex-start;
      justify-content:space-between;
      flex-wrap:wrap;
    }

    .badge{
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.05);
    }
    .badge.ok{ border-color: rgba(34,197,94,.35); background: rgba(34,197,94,.10); color: rgba(255,255,255,.92); }
    .badge.bad{ border-color: rgba(239,68,68,.40); background: rgba(239,68,68,.10); }
    .badge.warn{ border-color: rgba(245,158,11,.40); background: rgba(245,158,11,.10); }

    .statusText{
      color: var(--muted);
      font-size: 13px;
      line-height: 1.35;
      max-width: 720px;
      white-space: pre-wrap;
    }

    /* ======= ACTION BAR (—Å–¥–µ–ª–∞–ª–∏ –∑–∞–º–µ—Ç–Ω–µ–µ) ======= */
    .actionbar{
      position: sticky;
      bottom: 0;
      padding: 14px 18px;
      background: linear-gradient(180deg, rgba(10,12,22,.10), rgba(10,12,22,.70));
      backdrop-filter: blur(16px);
      border-top: 1px solid rgba(255,255,255,.10);
    }
    .actions{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .actionsLeft{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
      width: 100%;
    }

    button{
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--txt);
      border-radius: 14px;
      padding: 11px 12px;
      font-size: 13px;
      cursor:pointer;
      transition: transform .08s ease, border-color .15s ease, background .15s ease, opacity .15s ease;
      display:inline-flex;
      align-items:center;
      gap:8px;
      user-select:none;
    }
    button:hover{ transform: translateY(-1px); border-color: rgba(255,255,255,.22); background: rgba(255,255,255,.09); }
    button:active{ transform: translateY(0px); }
    button:disabled{ opacity: .55; cursor:not-allowed; transform:none; }

    .primary{
      background: linear-gradient(135deg, rgba(79,70,229,.95), rgba(6,182,212,.95));
      border-color: rgba(255,255,255,.22);
      box-shadow: 0 14px 34px rgba(79,70,229,.25);
      padding: 14px 16px;
      font-size: 14.5px;
      font-weight: 700;
      letter-spacing:.2px;
      width: 100%;
      justify-content:center;
    }
    .primary:hover{ background: linear-gradient(135deg, rgba(99,102,241,.98), rgba(34,211,238,.98)); }
    .secondary{
      padding: 12px 14px;
      font-weight: 600;
      background: rgba(255,255,255,.07);
    }
    .ghost{
      background: transparent;
      border-color: rgba(255,255,255,.12);
      color: rgba(255,255,255,.78);
    }

    @media (min-width: 860px){
      .primary{ width: auto; min-width: 280px; }
      .actionsLeft{ width:auto; }
    }

    .split{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      margin-top: 14px;
    }
    @media (max-width: 860px){ .split{ grid-template-columns: 1fr; } }

    .boxTitle{
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 8px;
    }

    .codebox{
      border: 1px solid var(--stroke);
      background: rgba(0,0,0,.20);
      border-radius: var(--radius2);
      padding: 12px;
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(255,255,255,.86);
      overflow:auto;
      white-space: pre;
      min-height: 128px;
    }

    /* ======= –î–æ–ø. —Ñ—É–Ω–∫—Ü–∏–∏ (–º–µ–Ω–µ–µ –∑–∞–º–µ—Ç–Ω—ã–µ) ======= */
    details.aux{
      margin-top: 14px;
      border: 1px dashed rgba(255,255,255,.18);
      background: rgba(255,255,255,.03);
      border-radius: var(--radius2);
      padding: 10px 12px;
    }
    details.aux > summary{
      cursor: pointer;
      color: rgba(255,255,255,.72);
      font-size: 12.5px;
      list-style:none;
      display:flex;
      align-items:center;
      gap:8px;
      user-select:none;
    }
    details.aux > summary::-webkit-details-marker{ display:none; }
    .auxBody{ margin-top: 10px; }
    .auxRow{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .auxBtn{
      padding: 9px 11px;
      font-size: 12.5px;
      border-radius: 12px;
      background: rgba(255,255,255,.05);
    }
    .auxNote{ font-size: 12px; color: var(--muted2); line-height: 1.35; margin-top: 8px; }

    .check{
      display:flex; align-items:center; gap:8px; padding: 6px 8px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      border-radius: 999px;
      font-size: 12px;
      color: rgba(255,255,255,.78);
    }
    .check input{ width:auto; }
    a.link{ color: rgba(125,211,252,.95); text-decoration:none; }
    a.link:hover{ text-decoration:underline; }

    .footerHelp{
      margin-top: 14px;
      padding: 14px 16px;
      border-top: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.12);
    }
    .footerHelp h2{
      margin:0 0 8px;
      font-size: 14px;
      letter-spacing:.2px;
    }
    .footerHelp ul{
      margin: 0;
      padding-left: 18px;
      color: rgba(255,255,255,.78);
      font-size: 12.5px;
      line-height: 1.45;
    }
    .footerHelp code{
      font-family: var(--mono);
      font-size: 12px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.10);
      padding: 2px 6px;
      border-radius: 8px;
    }

    .toast{
      margin-top: 10px;
      font-size: 12.5px;
      color: rgba(255,255,255,.78);
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Telegram Post Tools</h1>
          <div class="sub">–î–æ–±–∞–≤–∏—Ç—å/–∑–∞–º–µ–Ω–∏—Ç—å URL-–∫–Ω–æ–ø–∫—É –ø–æ–¥ –ø–æ—Å—Ç–æ–º + –∑–∞–∫—Ä–µ–ø–∏—Ç—å/–æ—Ç–∫—Ä–µ–ø–∏—Ç—å</div>
        </div>
      </div>
      <div class="pill">
        <div class="chip">1 —Ñ–∞–π–ª ‚Ä¢ –ª–æ–∫–∞–ª—å–Ω–æ</div>
        <div class="chip">editMessageReplyMarkup / pinChatMessage</div>
      </div>
    </div>

    <div class="card">
      <div class="content">
        <div class="grid">
          <div class="field">
            <label for="token">–¢–æ–∫–µ–Ω –±–æ—Ç–∞</label>
            <input id="token" type="password" placeholder="123456:ABC-DEF..." autocomplete="off" />
            <div class="hint">–°–æ–≤–µ—Ç: –Ω–µ –≤—ã–∫–ª–∞–¥—ã–≤–∞–π —ç—Ç–æ—Ç —Ñ–∞–π–ª –Ω–∞ –ø—É–±–ª–∏—á–Ω—ã–π —Ö–æ—Å—Ç–∏–Ω–≥ –≤–º–µ—Å—Ç–µ —Å —Ç–æ–∫–µ–Ω–æ–º.</div>
            <div class="row">
              <button class="ghost" id="toggleToken" type="button">üëÅÔ∏è –ü–æ–∫–∞–∑–∞—Ç—å</button>
              <button class="ghost" id="save" type="button">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ–ª—è</button>
              <button class="ghost" id="reset" type="button">üßπ –°–±—Ä–æ—Å</button>
            </div>
          </div>

          <div class="field">
            <label for="msgLink">–°—Å—ã–ª–∫–∞ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–∞/—á–∞—Ç–∞</label>
            <input id="msgLink" type="text" placeholder="https://t.me/testpemchanel/37" />
            <div class="hint">
              –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è: <code>t.me/&lt;username&gt;/&lt;id&gt;</code> –∏ <code>t.me/c/&lt;internalId&gt;/&lt;id&gt;</code>.
            </div>
            <div class="row">
              <span class="mini" id="parsed">chat_id: ‚Äî ‚Ä¢ message_id: ‚Äî</span>
              <a class="link" id="openLink" href="#" target="_blank" rel="noreferrer" style="display:none;">–û—Ç–∫—Ä—ã—Ç—å</a>
            </div>
          </div>

          <div class="field">
            <label for="btnText">–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏</label>
            <input id="btnText" type="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É" />
            <div class="hint">–≠—Ç–æ –±—É–¥–µ—Ç –ø–æ–¥–ø–∏—Å—å –Ω–∞ inline-–∫–Ω–æ–ø–∫–µ –ø–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–µ–º.</div>
          </div>

          <div class="field">
            <label for="btnUrl">–°—Å—ã–ª–∫–∞ –Ω–∞ –∫–Ω–æ–ø–∫–µ</label>
            <input id="btnUrl" type="text" placeholder="https://example.com/?utm_source=tg" />
            <div class="hint">–ú–æ–∂–Ω–æ –≤—Å—Ç–∞–≤–ª—è—Ç—å –æ–±—ã—á–Ω—ã–µ https-—Å—Å—ã–ª–∫–∏ –∏ t.me/tg:// deep-links.</div>
          </div>
        </div>

        <div class="status" id="statusBox" style="display:none;">
          <div class="statusLine">
            <div class="badge" id="badge">‚Ä¶</div>
            <div class="statusText" id="statusText"></div>
          </div>
          <div class="toast" id="corsHint" style="display:none;">
            ‚ö†Ô∏è –ï—Å–ª–∏ –≤–∏–¥–∏—à—å –æ—à–∏–±–∫—É —Å–µ—Ç–∏/CORS –≤ –±—Ä–∞—É–∑–µ—Ä–µ ‚Äî –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–π <b>curl</b> –Ω–∏–∂–µ (–∫–Ω–æ–ø–∫–∞ ‚Äú–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å curl‚Äù).
          </div>
        </div>

        <div class="split">
          <div>
            <div class="boxTitle">–ó–∞–ø—Ä–æ—Å (curl)</div>
            <div class="codebox" id="curlBox">‚Äî</div>
          </div>
          <div>
            <div class="boxTitle">–û—Ç–≤–µ—Ç Telegram API</div>
            <div class="codebox" id="respBox">‚Äî</div>
          </div>
        </div>

        <!-- –î–æ–ø. —Ñ—É–Ω–∫—Ü–∏–∏ (–º–µ–Ω–µ–µ –∑–∞–º–µ—Ç–Ω—ã–µ –∏ –Ω–∏–∂–µ) -->
        <details class="aux">
          <summary>‚öôÔ∏è –î–æ–ø. —Ñ—É–Ω–∫—Ü–∏–∏ (–∑–∞–∫—Ä–µ–ø–∏—Ç—å / –æ—Ç–∫—Ä–µ–ø–∏—Ç—å)</summary>
          <div class="auxBody">
            <div class="auxRow">
              <button class="auxBtn" id="pinBtn" type="button">üìå –ó–∞–∫—Ä–µ–ø–∏—Ç—å</button>
              <button class="auxBtn" id="unpinBtn" type="button">üìç –û—Ç–∫—Ä–µ–ø–∏—Ç—å</button>
              <label class="check" title="–ù–µ —Å–ª–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–∞–∫—Ä–µ–ø–µ (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)">
                <input id="silentPin" type="checkbox" />
                –¢–∏—Ö–æ (disable_notification)
              </label>
            </div>
            <div class="auxNote">
              –î–ª—è –∫–∞–Ω–∞–ª–æ–≤/–≥—Ä—É–ø–ø –±–æ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –∏ –∏–º–µ—Ç—å –ø—Ä–∞–≤–æ –∑–∞–∫—Ä–µ–ø–ª—è—Ç—å/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è. :contentReference[oaicite:4]{index=4}
            </div>
          </div>
        </details>
      </div>

      <!-- –°–¥–µ–ª–∞–ª–∏ —Å–Ω–∏–∑—É –∑–∞–º–µ—Ç–Ω—É—é –ø–∞–Ω–µ–ª—å –¥–µ–π—Å—Ç–≤–∏–π -->
      <div class="actionbar">
        <div class="actions">
          <div class="actionsLeft">
            <button class="primary" id="applyBtn" type="button">‚ú® –î–æ–±–∞–≤–∏—Ç—å (–∏–ª–∏ –∑–∞–º–µ–Ω–∏—Ç—å) –∫–Ω–æ–ø–∫—É –ø–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–µ–º</button>
            <button class="secondary" id="copyCurl" type="button">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å curl</button>
            <button class="ghost" id="clearMarkup" type="button">üóëÔ∏è –£–±—Ä–∞—Ç—å –∫–Ω–æ–ø–∫–∏</button>
          </div>
        </div>
        <div class="hint" style="margin-top:10px;">
          –ù–∞–∂–∞—Ç–∏–µ ‚Äú–î–æ–±–∞–≤–∏—Ç—å‚Äù <b>–∑–∞–º–µ–Ω—è–µ—Ç</b> —Ç–µ–∫—É—â—É—é inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —É —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ –æ–¥–Ω—É –∫–Ω–æ–ø–∫—É.
        </div>
      </div>

      <div class="footerHelp">
        <h2>–ß—Ç–æ –º–æ–∂–Ω–æ –≤—Å—Ç–∞–≤–ª—è—Ç—å –≤ ‚Äú–°—Å—ã–ª–∫–∞ –Ω–∞ –∫–Ω–æ–ø–∫–µ‚Äù</h2>
        <ul>
          <li>
            <b>–û–±—ã—á–Ω–∞—è https-—Å—Å—ã–ª–∫–∞</b>: <code>https://site.com/?utm_source=tg</code>
          </li>
          <li>
            <b>Deep-link –Ω–∞ –±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏</b> (–ø—Ä–∏–ª–µ—Ç–∏—Ç –∫–∞–∫ <code>/start payload</code>):  
            <code>https://t.me/your_bot?start=airplane</code> ‚Äî –¥–æ–ø—É—Å—Ç–∏–º—ã <code>A-Z a-z 0-9 _ -</code>, –¥–æ 64 —Å–∏–º–≤–æ–ª–æ–≤. :contentReference[oaicite:5]{index=5}
          </li>
          <li>
            <b>–î–æ–±–∞–≤–∏—Ç—å –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º</b>:  
            <code>https://t.me/your_bot?startgroup=spaceship</code> :contentReference[oaicite:6]{index=6}
          </li>
          <li>
            <b>–û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç/–ø—Ä–æ—Ñ–∏–ª—å –ø–æ username + –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç</b>:  
            <code>https://t.me/username?text=–ü—Ä–∏–≤–µ—Ç%20—è%20–ø–æ%20–æ–±—ä—è–≤–ª–µ–Ω–∏—é</code> (–≤ Telegram –æ—Ç–∫—Ä–æ–µ—Ç—Å—è —á–∞—Ç —Å —á–µ—Ä–Ω–æ–≤–∏–∫–æ–º —Ç–µ–∫—Å—Ç–∞). :contentReference[oaicite:7]{index=7}
          </li>
          <li>
            <b>–°—Å—ã–ª–∫–∞ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</b> (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–µ—Å—Ç–∏ –Ω–∞ –¥—Ä—É–≥–æ–π –ø–æ—Å—Ç):  
            <code>https://t.me/channelname/37</code> :contentReference[oaicite:8]{index=8}
          </li>
        </ul>
      </div>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);

    const el = {
      token: $("token"),
      toggleToken: $("toggleToken"),
      save: $("save"),
      reset: $("reset"),
      msgLink: $("msgLink"),
      btnText: $("btnText"),
      btnUrl: $("btnUrl"),
      parsed: $("parsed"),
      openLink: $("openLink"),

      applyBtn: $("applyBtn"),
      clearMarkup: $("clearMarkup"),
      copyCurl: $("copyCurl"),

      pinBtn: $("pinBtn"),
      unpinBtn: $("unpinBtn"),
      silentPin: $("silentPin"),

      statusBox: $("statusBox"),
      badge: $("badge"),
      statusText: $("statusText"),
      corsHint: $("corsHint"),

      curlBox: $("curlBox"),
      respBox: $("respBox"),
    };

    const LS_KEYS = {
      token: "tg_tools_token",
      msgLink: "tg_tools_msgLink",
      btnText: "tg_tools_btnText",
      btnUrl: "tg_tools_btnUrl",
    };

    function setStatus(kind, title, text, showCorsHint=false){
      el.statusBox.style.display = "block";
      el.badge.className = "badge " + (kind || "");
      el.badge.textContent = title || "";
      el.statusText.textContent = text || "";
      el.corsHint.style.display = showCorsHint ? "block" : "none";
    }

    function safeJson(obj){
      try { return JSON.stringify(obj, null, 2); } catch { return String(obj); }
    }

    function normalizeUrl(s){
      const t = (s || "").trim();
      if (!t) return "";
      if (/^https?:\/\//i.test(t)) return t;
      // allow bare t.me links
      if (/^(t\.me|telegram\.me)\//i.test(t)) return "https://" + t;
      return t; // could be tg://... or something else
    }

    function parseMessageLink(linkRaw){
      const link = normalizeUrl(linkRaw);
      if (!link) return { ok:false, error:"–ü—É—Å—Ç–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ." };

      // tg:// and other schemes are not message links we can parse
      if (/^tg:\/\//i.test(link)){
        return { ok:false, error:"–î–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è –Ω—É–∂–Ω–∞ —Å—Å—ã–ª–∫–∞ –≤–∏–¥–∞ https://t.me/.... (tg:// —Ç—É—Ç –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç)." };
      }

      let u;
      try { u = new URL(link); }
      catch {
        return { ok:false, error:"–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å URL. –ü—Ä–∏–º–µ—Ä: https://t.me/testchannel/37" };
      }

      const host = (u.hostname || "").toLowerCase();
      if (!["t.me","telegram.me","www.t.me","www.telegram.me"].includes(host)){
        // still allow, but warn
      }

      const parts = u.pathname.split("/").filter(Boolean);

      if (parts.length < 2){
        return { ok:false, error:"–°—Å—ã–ª–∫–∞ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å /<—á–∞—Ç>/<id> (–Ω–∞–ø—Ä–∏–º–µ—Ä /channel/37)." };
      }

      // private chats/channels: /c/<internalId>/<messageId> or /c/<internalId>/<threadId>/<messageId>
      if (parts[0] === "c"){
        if (parts.length < 3) return { ok:false, error:"–§–æ—Ä–º–∞—Ç /c/<id>/<messageId> –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω." };
        const internalId = parts[1];
        const messageId = parts[parts.length - 1];
        if (!/^\d+$/.test(internalId) || !/^\d+$/.test(messageId)){
          return { ok:false, error:"–í /c/... –æ–∂–∏–¥–∞–ª–∏—Å—å —á–∏—Å–ª–æ–≤—ã–µ id." };
        }
        return {
          ok:true,
          chat_id: "-100" + internalId,
          message_id: Number(messageId),
          human: `chat_id: -100${internalId} ‚Ä¢ message_id: ${messageId}`
        };
      }

      // public: /<username>/<messageId> (or /<username>/<threadId>/<messageId>)
      const username = parts[0];
      const messageId = parts[parts.length - 1];
      if (!/^\d+$/.test(messageId)){
        return { ok:false, error:"ID —Å–æ–æ–±—â–µ–Ω–∏—è –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º (–ø—Ä–∏–º–µ—Ä: .../37)." };
      }
      if (!/^[A-Za-z0-9_]+$/.test(username)){
        // username may still be valid, but we'll be strict-ish
      }
      return {
        ok:true,
        chat_id: "@" + username,
        message_id: Number(messageId),
        human: `chat_id: @${username} ‚Ä¢ message_id: ${messageId}`
      };
    }

    function buildInlineMarkup(text, url){
      return { inline_keyboard: [[{ text, url }]] };
    }

    function apiUrl(token, method){
      return `https://api.telegram.org/bot${token}/${method}`;
    }

    function buildCurl(token, method, payload){
      const url = apiUrl(token, method);
      return [
        `curl -sS -X POST ${JSON.stringify(url)} \\`,
        `  -H "Content-Type: application/json" \\`,
        `  -d ${JSON.stringify(JSON.stringify(payload))}`
      ].join("\n");
    }

    async function callTelegram(method, payload){
      const token = el.token.value.trim();
      if (!token) throw new Error("–ù–µ —É–∫–∞–∑–∞–Ω —Ç–æ–∫–µ–Ω –±–æ—Ç–∞.");

      const url = apiUrl(token, method);

      // Show curl always
      el.curlBox.textContent = buildCurl(token, method, payload);

      const res = await fetch(url, {
        method: "POST",
        headers: { "Content-Type":"application/json" },
        body: JSON.stringify(payload)
      });

      const text = await res.text();
      let data;
      try { data = JSON.parse(text); }
      catch { data = { ok:false, description:"–ù–µ JSON –≤ –æ—Ç–≤–µ—Ç–µ", raw:text }; }
      el.respBox.textContent = safeJson(data);
      return data;
    }

    function updateParsedUI(){
      const parsed = parseMessageLink(el.msgLink.value);
      if (!parsed.ok){
        el.parsed.textContent = "chat_id: ‚Äî ‚Ä¢ message_id: ‚Äî";
        el.openLink.style.display = el.msgLink.value.trim() ? "inline" : "none";
        if (el.msgLink.value.trim()){
          el.openLink.href = normalizeUrl(el.msgLink.value.trim());
        }
        return parsed;
      }
      el.parsed.textContent = parsed.human;
      el.openLink.style.display = "inline";
      el.openLink.href = normalizeUrl(el.msgLink.value.trim());
      return parsed;
    }

    function setBusy(busy){
      [el.applyBtn, el.clearMarkup, el.copyCurl, el.pinBtn, el.unpinBtn, el.save, el.reset].forEach(b => b.disabled = busy);
      el.applyBtn.textContent = busy ? "‚è≥ –í—ã–ø–æ–ª–Ω—è—é –∑–∞–ø—Ä–æ—Å..." : "‚ú® –î–æ–±–∞–≤–∏—Ç—å (–∏–ª–∏ –∑–∞–º–µ–Ω–∏—Ç—å) –∫–Ω–æ–ø–∫—É –ø–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–µ–º";
    }

    async function handleAddButton(){
      const token = el.token.value.trim();
      const parsed = updateParsedUI();
      const txt = el.btnText.value.trim();
      const url = el.btnUrl.value.trim();

      if (!token){
        setStatus("bad","–ù–µ—Ç —Ç–æ–∫–µ–Ω–∞","–í–≤–µ–¥–∏ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞.");
        return;
      }
      if (!parsed.ok){
        setStatus("bad","–ü–ª–æ—Ö–∞—è —Å—Å—ã–ª–∫–∞", parsed.error);
        return;
      }
      if (!txt){
        setStatus("bad","–ù–µ—Ç —Ç–µ–∫—Å—Ç–∞","–í–≤–µ–¥–∏ —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏.");
        return;
      }
      if (!url){
        setStatus("bad","–ù–µ—Ç —Å—Å—ã–ª–∫–∏","–í–≤–µ–¥–∏ —Å—Å—ã–ª–∫—É –¥–ª—è –∫–Ω–æ–ø–∫–∏.");
        return;
      }

      const payload = {
        chat_id: parsed.chat_id,
        message_id: parsed.message_id,
        reply_markup: buildInlineMarkup(txt, url)
      };

      setBusy(true);
      try{
        const data = await callTelegram("editMessageReplyMarkup", payload);
        if (data && data.ok){
          setStatus("ok","–ì–æ—Ç–æ–≤–æ","–ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞/–æ–±–Ω–æ–≤–ª–µ–Ω–∞ –ø–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–µ–º ‚úÖ");
        } else {
          const desc = (data && (data.description || data.raw)) ? (data.description || data.raw) : "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞";
          const code = data && data.error_code ? ` (code ${data.error_code})` : "";
          setStatus("bad","–û—à–∏–±–∫–∞", `Telegram API –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É${code}:\n${desc}`);
        }
      } catch (e){
        el.respBox.textContent = String(e);
        setStatus("bad","–°–µ—Ç—å/CORS?", `–ó–∞–ø—Ä–æ—Å –Ω–µ –≤—ã–ø–æ–ª–Ω–∏–ª—Å—è –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞:\n${e.message || e}\n\n–°–∫–æ–ø–∏—Ä—É–π curl –∏ –≤—ã–ø–æ–ª–Ω–∏ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ.`, true);
      } finally{
        setBusy(false);
      }
    }

    async function handleClearMarkup(){
      const token = el.token.value.trim();
      const parsed = updateParsedUI();
      if (!token){
        setStatus("bad","–ù–µ—Ç —Ç–æ–∫–µ–Ω–∞","–í–≤–µ–¥–∏ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞.");
        return;
      }
      if (!parsed.ok){
        setStatus("bad","–ü–ª–æ—Ö–∞—è —Å—Å—ã–ª–∫–∞", parsed.error);
        return;
      }

      // –û–±—ã—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç: –ø—É—Å—Ç–∞—è inline_keyboard
      const payload = {
        chat_id: parsed.chat_id,
        message_id: parsed.message_id,
        reply_markup: { inline_keyboard: [] }
      };

      setBusy(true);
      try{
        const data = await callTelegram("editMessageReplyMarkup", payload);
        if (data && data.ok){
          setStatus("ok","–ì–æ—Ç–æ–≤–æ","–ö–Ω–æ–ø–∫–∏ —É–±—Ä–∞–Ω—ã ‚úÖ");
        } else {
          const desc = (data && (data.description || data.raw)) ? (data.description || data.raw) : "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞";
          const code = data && data.error_code ? ` (code ${data.error_code})` : "";
          setStatus("bad","–û—à–∏–±–∫–∞", `Telegram API –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É${code}:\n${desc}`);
        }
      } catch (e){
        el.respBox.textContent = String(e);
        setStatus("bad","–°–µ—Ç—å/CORS?", `–ó–∞–ø—Ä–æ—Å –Ω–µ –≤—ã–ø–æ–ª–Ω–∏–ª—Å—è –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞:\n${e.message || e}\n\n–°–∫–æ–ø–∏—Ä—É–π curl –∏ –≤—ã–ø–æ–ª–Ω–∏ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ.`, true);
      } finally{
        setBusy(false);
      }
    }

    async function handlePin(unpin=false){
      const token = el.token.value.trim();
      const parsed = updateParsedUI();
      if (!token){
        setStatus("bad","–ù–µ—Ç —Ç–æ–∫–µ–Ω–∞","–í–≤–µ–¥–∏ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞.");
        return;
      }
      if (!parsed.ok){
        setStatus("bad","–ü–ª–æ—Ö–∞—è —Å—Å—ã–ª–∫–∞", parsed.error);
        return;
      }

      let method, payload;
      if (!unpin){
        method = "pinChatMessage";
        payload = {
          chat_id: parsed.chat_id,
          message_id: parsed.message_id,
          disable_notification: !!el.silentPin.checked
        };
      } else {
        method = "unpinChatMessage";
        payload = {
          chat_id: parsed.chat_id,
          message_id: parsed.message_id
          // message_id optional –ø–æ –¥–æ–∫–µ; –µ—Å–ª–∏ —É–±—Ä–∞—Ç—å ‚Äî –æ—Ç–∫—Ä–µ–ø–∏—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–∫—Ä–µ–ø 
        };
      }

      setBusy(true);
      try{
        const data = await callTelegram(method, payload);
        if (data && data.ok){
          setStatus("ok","–ì–æ—Ç–æ–≤–æ", unpin ? "–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–∫—Ä–µ–ø–ª–µ–Ω–æ ‚úÖ" : "–°–æ–æ–±—â–µ–Ω–∏–µ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–æ ‚úÖ");
        } else {
          const desc = (data && (data.description || data.raw)) ? (data.description || data.raw) : "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞";
          const code = data && data.error_code ? ` (code ${data.error_code})` : "";
          setStatus("bad","–û—à–∏–±–∫–∞", `Telegram API –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É${code}:\n${desc}`);
        }
      } catch (e){
        el.respBox.textContent = String(e);
        setStatus("bad","–°–µ—Ç—å/CORS?", `–ó–∞–ø—Ä–æ—Å –Ω–µ –≤—ã–ø–æ–ª–Ω–∏–ª—Å—è –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞:\n${e.message || e}\n\n–°–∫–æ–ø–∏—Ä—É–π curl –∏ –≤—ã–ø–æ–ª–Ω–∏ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ.`, true);
      } finally{
        setBusy(false);
      }
    }

    function saveFields(){
      localStorage.setItem(LS_KEYS.token, el.token.value);
      localStorage.setItem(LS_KEYS.msgLink, el.msgLink.value);
      localStorage.setItem(LS_KEYS.btnText, el.btnText.value);
      localStorage.setItem(LS_KEYS.btnUrl, el.btnUrl.value);
      setStatus("ok","–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ","–ü–æ–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ localStorage —ç—Ç–æ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞.");
    }

    function loadFields(){
      el.token.value = localStorage.getItem(LS_KEYS.token) || "";
      el.msgLink.value = localStorage.getItem(LS_KEYS.msgLink) || "";
      el.btnText.value = localStorage.getItem(LS_KEYS.btnText) || "";
      el.btnUrl.value = localStorage.getItem(LS_KEYS.btnUrl) || "";
      updateParsedUI();
    }

    function resetFields(){
      el.token.value = "";
      el.msgLink.value = "";
      el.btnText.value = "";
      el.btnUrl.value = "";
      el.curlBox.textContent = "‚Äî";
      el.respBox.textContent = "‚Äî";
      el.statusBox.style.display = "none";
      updateParsedUI();
      localStorage.removeItem(LS_KEYS.token);
      localStorage.removeItem(LS_KEYS.msgLink);
      localStorage.removeItem(LS_KEYS.btnText);
      localStorage.removeItem(LS_KEYS.btnUrl);
    }

    async function copyCurl(){
      const text = el.curlBox.textContent.trim();
      if (!text || text === "‚Äî"){
        setStatus("warn","–ù–µ—á–µ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å","–°–Ω–∞—á–∞–ª–∞ —Å–¥–µ–ª–∞–π –¥–µ–π—Å—Ç–≤–∏–µ (–∏–ª–∏ –∑–∞–ø–æ–ª–Ω–∏ –ø–æ–ª—è), —á—Ç–æ–±—ã —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–ª—Å—è curl.");
        return;
      }
      try{
        await navigator.clipboard.writeText(text);
        setStatus("ok","–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ","curl —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞ ‚úÖ");
      } catch {
        // fallback
        setStatus("warn","–ù–µ —É–¥–∞–ª–æ—Å—å","–ë—Ä–∞—É–∑–µ—Ä –∑–∞–ø—Ä–µ—Ç–∏–ª Clipboard API. –°–∫–æ–ø–∏—Ä—É–π –≤—Ä—É—á–Ω—É—é –∏–∑ –ø–æ–ª—è curl.");
      }
    }

    // events
    el.toggleToken.addEventListener("click", () => {
      const isPass = el.token.type === "password";
      el.token.type = isPass ? "text" : "password";
      el.toggleToken.textContent = isPass ? "üôà –°–∫—Ä—ã—Ç—å" : "üëÅÔ∏è –ü–æ–∫–∞–∑–∞—Ç—å";
    });

    el.save.addEventListener("click", saveFields);
    el.reset.addEventListener("click", resetFields);

    el.msgLink.addEventListener("input", updateParsedUI);
    [el.btnText, el.btnUrl, el.token].forEach(x => x.addEventListener("input", () => {
      // keep parsed updated, but don't spam
    }));

    el.applyBtn.addEventListener("click", handleAddButton);
    el.clearMarkup.addEventListener("click", handleClearMarkup);
    el.copyCurl.addEventListener("click", copyCurl);

    el.pinBtn.addEventListener("click", () => handlePin(false));
    el.unpinBtn.addEventListener("click", () => handlePin(true));

    // init
    loadFields();
  </script>
</body>
</html>
